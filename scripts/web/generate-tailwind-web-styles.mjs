#!/usr/bin/env node
import { execFileSync } from 'node:child_process';
import { mkdirSync, readFileSync, writeFileSync } from 'node:fs';
import { dirname, join } from 'node:path';
import { fileURLToPath } from 'node:url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const repoRoot = join(__dirname, '..', '..');
const inputCss = join(repoRoot, 'src', 'web', 'tailwind.input.css');
const outCss = join(repoRoot, 'dist', '.tmp-web-tailwind.css');
const outTs = join(repoRoot, 'src', 'web', 'tailwind-styles.ts');

mkdirSync(dirname(outCss), { recursive: true });

execFileSync(
  'pnpm',
  ['exec', 'tailwindcss', '-i', inputCss, '-o', outCss, '--minify'],
  {
    cwd: repoRoot,
    stdio: 'inherit',
  },
);

const css = readFileSync(outCss, 'utf8');
const banner = '// This file is auto-generated by scripts/web/generate-tailwind-web-styles.mjs\n';
const content = `${banner}export const WEB_TAILWIND_CSS = ${JSON.stringify(css)};\n`;
writeFileSync(outTs, content, 'utf8');

console.log(`Generated ${outTs}`);
